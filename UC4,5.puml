@startuml
title UC4,5: Apply Board Movement Rule


participant ":GameController" as GameController
participant ":PieceMoveController" as PieceMoveController
participant ":GameViewInterface" as GameViewInterface
participant ":Piece" as Piece
participant “:Board” as Board

' 여기도 마찬가지, Board가 딱히 쓰이지 않음. 이것도 재검토 필요.


GameController -> PieceMoveController : setMovementInfo()

alt piece is not on board and steps > 0
	alt 빽도의 경우
    	PieceMoveController -> GameController : unableToMove()
    	GameController -> GameViewInterface : display("이동불가")
    else 도, 개, 걸, 윷, 모의 경우
    	PieceMoveController -> Piece : setOnBoard
    	Board -> PieceMoveController : getDestinationCell()
        PieceMoveController -> Piece : moveTo(Destination))
        PieceMoveController -> Piece : finishCheck()
        Piece -> GameViewInterface : displayPosition()
    end alt

else if piece is on board
    alt 빽도의 경우
        	Board -> PieceMoveController : getDestinationCell()
            PieceMoveController -> Piece : moveTo(Destination)
            PieceMoveController -> Piece : finishCheck()
            alt piece is not finished
                ref over GameController, PieceMoveController
                	UC6 : Capture and Grouping
                end ref
            end
    else 도, 개, 걸, 윷, 모의 경우
    	alt 외곽 순환
    	    Board -> PieceMoveController : getDestinationCell()
        	PieceMoveController -> Piece : moveTo(Destination))
        	PieceMoveController -> Piece : finishCheck()
        else 꼭짓점 도착
        	alt 마지막 꼭짓점과 마지막에서 2번째 꼭짓점이 아닐때
        	    Board -> PieceMoveController : getDestinationCell()
        		PieceMoveController -> Piece : moveTo(종료지점과 두번째로 가까운 꼭짓점 방향으로 변경)
        		PieceMoveController -> Piece : finishCheck()
        	end alt
       	else 중심점 도착
           	Board -> PieceMoveController : getDestinationCell()
       		PieceMoveController -> Piece : moveTo(도착지점으로 방향 변경)
       		PieceMoveController -> Piece : finishCheck()
        end alt
        Piece -> GameViewInterface : displayPosition()
        alt piece is not finished
            ref over GameController, PieceMoveController
            	UC6 : Capture and Grouping
            end ref
        end
    end
end

@enduml
